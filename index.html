<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JPM</title>
</head>

<style>
    h2 {
        color: #2a70b9;
        font: normal bold 18px 'Arial', sans-serif;
        text-transform: uppercase;
    }

    .hide {
        display: none;
    }
    .child {
        margin-left: 40px;
    }
    .trigger {
        text-decoration: underline;
    }

    label, span {
        font: normal bold 15px 'Arial', sans-serif;
        color: #2b2b29;
        margin-right: 20px;
    }

    label.radio_label {
        position: relative;
        margin-right: 0;
        top: -1px;
        font-weight: normal;
        color: #979797;
    }

    input {
        display: block;
        padding: 10px;
        margin-bottom: 20px;
        width: 400px;
    }

    input[type='radio']{
        display: inline;
        width: auto;
        margin-right: 10px;
    }
    input[type='text'], textarea {
        margin-top: 10px;
    }

    textarea {
        width: 400px;
        height: 100px;
        display: block;
        margin-bottom: 20px;
    }

    button {
        background: #2a70b9;
        color: #fff;
        text-transform: uppercase;
        padding: 10px;
        border: none;
        cursor: pointer;
        transition: all 0.2s ease;
        margin-top: 20px;
    }

    button:hover {
        background: #215893;
    }

</style>
<body>

    <div class="container">
        <form id="jpm_form" action="" method="get">
            <div id="insubordinacion">
                <h2>Insubordinación</h2>
            </div>
            <div id="insubordinacion_exigencia">
                <h2>Insubordinación por exigencia</h2>
            </div>
            <button>Guardar Respuestas</button>
        </form>
    </div>

    

    
    <script>
        const insubordinacion = document.querySelector('#insubordinacion');
        const insubordinacion_exigencia = document.querySelector('#insubordinacion_exigencia');

        async function fetchChcrime() {
            try {
                const response = await fetch('http://127.0.0.1:5500/info.json');
                const chrime = await response.json();
                return chrime;
            } catch (error) {
                return [null, error];
            }
        }

        fetchChcrime().then(chrimes => {
            
            chrimes.forEach(function(chrime){
                
                // Define which type of field
                function elemType(){
                    if(chrime.tipoDePregunta3chkabcsiNo3chksolodescripcion == 'TEXTO UNA LÍNEA'){
                        const chrimeElement = document.createElement('div');
                        chrimeElement.id = `${chrime.idPregunta}`;
                        chrimeElement.classList.add('wrapper');
                        const chrimeLabel = document.createElement('label');
                        chrimeLabel.innerText = `${chrime.nombrePreguntanmpreguntas}`;
                        const chrimeField = document.createElement('input');
                        chrimeField.type = 'text';
                        chrimeField.name = `${chrime.idPregunta}`;
                        chrimeElement.append(chrimeLabel);
                        chrimeElement.append(chrimeField);
                        return chrimeElement;
                    } 
                    else if(chrime.tipoDePregunta3chkabcsiNo3chksolodescripcion == 'AREA DE TEXTO'){
                        const chrimeElement = document.createElement('div');
                        chrimeElement.id = `${chrime.idPregunta}`;
                        chrimeElement.classList.add('wrapper');
                        const chrimeLabel = document.createElement('label');
                        chrimeLabel.innerText = `${chrime.nombrePreguntanmpreguntas}`;
                        const chrimeField = document.createElement('textarea');
                        chrimeField.name = `${chrime.idPregunta}`;
                        chrimeElement.append(chrimeLabel);
                        chrimeElement.append(chrimeField);
                        return chrimeElement;
                    } 
                    else if(chrime.tipoDePregunta3chkabcsiNo3chksolodescripcion == 'SI/NO') {
                        const chrimeElement = document.createElement('div');
                        chrimeElement.id = `${chrime.idPregunta}`;
                        chrimeElement.classList.add('wrapper');
                        const chrimeSpan = document.createElement('span');
                        chrimeSpan.innerText = `${chrime.nombrePreguntanmpreguntas}`;
                        const chrimeLabel = document.createElement('label');
                        chrimeLabel.innerText = `Sí`;
                        chrimeLabel.classList.add('radio_label');
                        const chrimeField = document.createElement('input');
                        chrimeField.type = 'radio';
                        chrimeField.value = 'si';
                        chrimeField.name = `${chrime.idPregunta}`;

                        const chrimeLabel2 = document.createElement('label');
                        chrimeLabel2.innerText = `No`;
                        const chrimeField2 = document.createElement('input');
                        chrimeField2.type = 'radio';
                        chrimeLabel2.classList.add('radio_label');
                        chrimeField2.value = 'no';
                        chrimeField2.name = `${chrime.idPregunta}`;

                        chrimeElement.appendChild(chrimeSpan);
                        chrimeElement.appendChild(chrimeLabel);
                        chrimeElement.appendChild(chrimeField);
                        chrimeElement.appendChild(chrimeLabel2);
                        chrimeElement.appendChild(chrimeField2);
                        return chrimeElement;
                    } 
                    else {
                        const chrimeElement = document.createElement('p');
                        chrimeElement.id = `${chrime.idPregunta}`;
                        
                        const note = document.createTextNode(chrime.nombrePreguntanmpreguntas); 
                        chrimeElement.appendChild(note);
                        return chrimeElement;
                    }
                }

                const chrimeElement = elemType();
                
                if(chrime.idePreguntaPadre){
                    chrimeElement.classList.add(`parent_id_${chrime.idePreguntaPadre}`);
                    chrimeElement.classList.add('hide');
                    chrimeElement.classList.add('child');
                } 
                
                if(chrime.respuestaQueHabilitaRespuestaHijo){
                    const fields = chrimeElement.querySelectorAll('input');
                    [...fields].map(function(field){
                        field.classList.add('trigger');
                    })
                }

                if(chrime.nombreDelito == 'Insubordinación' && chrime.idePreguntaPadre){
                    const parentElem = document.getElementById(`${chrime.idePreguntaPadre}`);
                    parentElem.append(chrimeElement);
                } else if(chrime.nombreDelito == 'Insubordinación'){
                    insubordinacion.appendChild(chrimeElement);
                }

                if(chrime.nombreDelito == 'Insubordinación por exigencia' && chrime.idePreguntaPadre){
                    const parentElem = document.getElementById(`${chrime.idePreguntaPadre}`);
                    parentElem.append(chrimeElement);
                } else if(chrime.nombreDelito == 'Insubordinación por exigencia'){
                    insubordinacion_exigencia.appendChild(chrimeElement);
                }
            });

            //Fetch triggers
            const triggers = document.querySelectorAll('.trigger');
            
            // Add click listener to every trigger
            [...triggers].map(function(trigger){
                trigger.addEventListener('click', function(e){
                    // Get parent padding
                    let parentPadding = window.getComputedStyle(e.target.parentNode, null).getPropertyValue('margin-left');
                    parentPadding = parentPadding.split('px');
                    parentPadding = parseInt(parentPadding[0]);
                    
                    // Fetch trigger's children and remove hide class
                    const elemsShow = document.querySelectorAll(`.parent_id_${e.target.parentNode.id}`);
                    console.log(elemsShow);
                    [...elemsShow].map(elem => {
                        if(trigger.value == 'si'){
                            elem.classList.remove('hide');
                        } else {
                            elem.classList.add('hide');

                            // Get children fields
                            childrenFields = document.querySelectorAll(`.parent_id_${e.target.parentNode.id} input`);
                            [...childrenFields].map(function(childrenField){
                                childrenField.checked = false;  
                                childrenField.parentNode.classList.add('hide');
                            });

                            childrenTextAreas = document.querySelectorAll(`.parent_id_${e.target.parentNode.id} textarea`);
                            [...childrenTextAreas].map(function(childrenTextArea){ 
                                childrenTextArea.value = '';
                                childrenTextArea.parentNode.classList.add('hide');
                            });

                            childrenInputTexts = document.querySelectorAll(`.parent_id_${e.target.parentNode.id} input[type='text']`); 
                            [...childrenInputTexts].map(function(childrenInputText){ 
                                console.log(childrenInputText)
                                childrenInputText.value = '';
                                childrenInputText.parentNode.classList.add('hide');
                            });
                            console.log(childrenFields)
                        }

                        // Add up parent padding to indent child
                        const childPadding = parentPadding + 40;
                        elem.style.marginLeft = `${childPadding}px`;
                    })
                })
            }); 

            // const form = document.querySelector('#jpm_form');

            // form.addEventListener('submit', function(e){
            //     e.preventDefault()
            // })
        }); 

    </script>
</body>
</html>